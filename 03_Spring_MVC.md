## 0. 목차

## 1. 웹 서버 & 웹 애플리케이션 서버
### 1-1. 웹 서버(Web Server)
- HTTP 기반으로 동작
- 정적 리소스 제공, 기타 부가기능
- 정적(파일) HTML, CSS, JS, 이미지, 영상
- 예) NGINX, APACHE
![image](https://user-images.githubusercontent.com/109258397/220804527-b56b5e07-56e5-43da-8026-aae599422c97.png)

### 1-2. 웹 애플리케이션 서버(WAS-Web Application Server)
- HTTP기반으로 동작
- 웹 서버 기능 포함 + (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행
  - 동적 HTML, HTTP API(JSON)
  - 서블릿, JSP, 스프링 MVC
- 예) 톰캣, Jetty, Undertow
![image](https://user-images.githubusercontent.com/109258397/220804930-fdfa1578-9066-4337-88cf-3dbd2c235b4d.png)

### 1-3. 차이
- 웹 서버는 정적 리소스(파일), WAS는 애플리케이션 로직
- 사실은 둘의 용어도 경계도 모호함
  - 웹 서버도 프로그램을 실행하는 기능을 포함하기도 함
  - 웹 애플리케이션 서버도 웹서버의 기능을 제공함
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS(서블릿 없이 자바코드를 실행하는 서버 프레임워크도 있음)
- WAS는 애플리케이션 코드를 실행하는데 더 특화

### 1-4. 웹 시스템 구성
-  WAS, DB 만으로 시스템 구성 가능
  -  WAS는 정적 리소스, 애플리케이션 로직 모두 제공 가능
  -  WAS가 너무 많은 역할을 담당, 서버 과부하 우려
  -  가장 비싼 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있음
  -  WAS장애시 오류화면도 노출 불가능
    ![image](https://user-images.githubusercontent.com/109258397/222216708-f448ef1d-3609-4edb-8d64-d778f026ca25.png)

- WEB, WAS, DB 구성
  - 정적 리소스는 웹 서버가 처리
  - 웹 서버는 애플리케이션 로직같은 동적인 처리가 필요하면 WAS에 요청을 위임
  - WAS 는 중요한 애플리케이션 로직 처리 전담
  ![image](https://user-images.githubusercontent.com/109258397/222217466-1ddfc14f-6481-4985-9ddf-8b3bfe5e5a95.png)
  - 효율적인 리소스 관리
    - 정적 리소스가 많이 사용 -> Web 서버 증설 / 애플리케이션 리소스 -> WAS 증설
  - 정적 리소스만 제공하는 웹서는 잘 죽지 않음, 애플리케이션 로직이 동작하는 WAS서버는 잘죽음
  - WAS, DB 장애시 WEB 서버가 오류 화면 제공 가능

## 2. 서블릿

### 2-1. 서블릿이란?
- 서블릿은 웹 서버의 성능을 향상하기 위해 사용되는 자바 클래스의 일종.
- 클라이언트의 요청에 맞춰 동적인 결과를 만들어 주는 자바 웹 프로그래밍 기술
- 서블릿 컨테이너 안에서 동작
- 서블릿의 특징
  - 클라이언트 요청에 동적으로 응답하는 웹 어플리케이션 컴포넌트
  - JAVA의 쓰레드 사용
  - MVC패턴의 Controller 역할을 맡음
  - HTTP프로토콜 서비스를 지원하는 javax.servlet.http.HttpServlet클래스를 상속받음

### 2-2. HTML Form 데이터 전송
- POST전송 - 저장
  ![image](https://user-images.githubusercontent.com/109258397/222297876-c9287bfc-e096-464a-a3e7-87f2172cd2a9.png)
- 의미있는 비즈니스 로직 전에 과정이 너무 중복, 길다 ->  서블릿의 등장
  ![image](https://user-images.githubusercontent.com/109258397/222298308-d5f6b611-0d15-4177-a1a7-34524d516920.png)
- 서블릿 특징
  ![image](https://user-images.githubusercontent.com/109258397/222298559-f7dcc2b8-d00b-47f4-b5e2-420ecf008cf6.png)
- HTTP 요청, 응답 흐름
  - HTTP 요청시
    - WAS는 Request, Response 객체를 새로 만들어 서블릿 객체 호출
    - 개발자는 Request 객체에서 HTTP 요청 정보를 편리하게 꺼내서 사용
    - 개발자는 Response 객체에 HTTP 응답 정보를 편리하게 입력
    - WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성
  ![image](https://user-images.githubusercontent.com/109258397/222299466-45a87fd9-1132-4248-b9d9-a6d58d5e96cd.png)

### 2-3. 서블릿 컨테이너
- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고함
- 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리(하나의 객체만 만들어 재사용)
  - 고객의 요청시 계속 객체 생성은 비효율
  - 최초 로딩시 서블릿 객체를 미리 만들어두고 재활용
  - **공유 변수 사용 주의**
  - 서블릿 컨테이너 종료시 함께 종료
- JSP도 서블릿으로 변환되어 사용
- 동시 요청을 위한 멀티 쓰레드 처리 지원

### 2-4. 동시 요청 - 멀티 쓰레드
- 서블릿 객체를 호출하는 것 -> 쓰레드
  ![image](https://user-images.githubusercontent.com/109258397/222301113-5758fdff-b284-49b2-9e5f-57bcb7a70aca.png)
- Thread
  - 애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드
  - 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행
  - 쓰레드가 없다면 자바 애플리케이션 실행이 불가능
  - 쓰레드는 한번에 하나의 코드라인만 수행
  - 동시 처리가 필요하면 쓰레드를 추가 생성
- 단일 요청 -> 쓰레드 하나 사용
  ![image](https://user-images.githubusercontent.com/109258397/222302260-200e8e52-d01a-4d5d-b516-f135d74b6976.png)
  - 다중 요청시 쓰레드 하나 사용하면 요청1 처리 지연되면 요청2는 계속 대기, 수행X
- 요청 마다 쓰레드 생성시 장단점
  - 동시요청을 처리
  - 리소스가 허용할 때가지 처리가능
  - 하나의 쓰레드가 지연되어도, 나머지 쓰레드는 정상동작
  - 쓰레드는 생성 비용은 매우 비쌈
    - 고객의 요청마다 쓰레드 생성시 응답속도가 늦어진다.
  - 쓰레드는 컨텍스트 스위칭 비용이 발생
  - 쓰레드 생성에 제한이 없음
    - 요청이 너무많아지면 CPU, 메모리 임계점을 넘어 서버가 죽을 수 있다.
- 쓰레드 풀
  ![image](https://user-images.githubusercontent.com/109258397/222428131-b00cd733-b50b-4cf6-bf2c-662813e31cbe.png)
  - 요청 마다 쓰레드 생성의 단점 보완
  - 특징
    - 필요한 쓰레드를 풀에 보관하고 관리
    - 풀에 생성 가능한 쓰레드의 최대치를 관리, 톰캣은 최대 200개 기본 설정(변경 가능)
  - 사용
    - 이미 생성되어 있는 쓰레드를 풀에서 꺼내서 사용
    - 사용 종료시 풀에 쓰레드를 반납
    - 쓰레드가 모두 사용중이면 기다리는 요청은 거절하나 특정 숫자만큼만 대기하도록 설정
  - 장점
    - 쓰레드가 생성되어 있으므로 생성/종료 비용(CPU) 절약, 응답시간 빠름
    - 생성 가능한 쓰레드 최대치가 있어 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리 가능
  - 실무 팁
    - WAS의 주요 튜닝 포인트는 최대 쓰레드(max thread)수
    - 이 값이 너무낮으면 -> 동시요청이 많으면, 서버 리소스는 여유, 클라이언트는 금방 응답 지연
    - 높으면 -> CPU, 메모리 리소스 임계점 초과로 서버 다운
    - 장애발생시?
      - 클라우드면 일단 서버 확장, 이후 튜닝
      - 클라우드가 아니면 열심히 튜닝
- WAS의 멀티 쓰레드 지원
  - WAS가 멀티 쓰레드 부분 처리
  - 개발자가 멀티 쓰레드 관련 코드 신경x
  - 개발자는 싱글 쓰레드 프로그래밍을 하듯이 편리하게 개발
  - 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용

## 3. HTML, HTTP API, CSR, SSR
### 3-1. HTML페이지
- 동적으로 필요한 HTML파일 생성,  전달 / 웹브라우저 : HTML 해석
  ![image](https://user-images.githubusercontent.com/109258397/222916994-809a8b47-dd12-42cd-b7df-82f68beb72d7.png)

### 3-2. HTTP API
- HTML x, 데이터를 전달 / UI화면이 필요하면 클라이언트가 별도 처리
- 주로 JSON형식 사용
- 다양한 시스템에서 호출
- 앱, 웹 클라이언트, 서버 to 서버
  ![image](https://user-images.githubusercontent.com/109258397/222917400-e6702e4c-a1c3-4b93-ae4c-a7044bb46b9c.png)
- UI 클라이언트 접점
  - 앱 클라이언트(아이폰, 안드로이드, PC 앱)
  - 웹 브라우저에서 자바스크립트를 통한 HTTP API호출
  - React, Vue.js 같은 웹 클라이언트
- 서버 to 서버
  - 주문 서버 -> 결제 서버
  - 기업간 데이터 통신

### 3-3. 서버사이드 렌더링, 클라이언트 사이드 렌더링
- SSR : 서버 사이드 렌더링, HTML 최종결과를 서버에서 만들어 웹 브라우저에게 전달
  ![image](https://user-images.githubusercontent.com/109258397/222917805-77914289-49e9-453f-98fe-7a06299c9877.png)
  - 주로 정적인 화면에 사용
  - 관련기술 : JSP, 타임리프 -> 백엔드 개발자
- CSR  : 클라이언트 사이드 렌더링, HTML결과를 자바스크립트를 사용 웹 브라우저에서 동적으로 생성해서 적용
  ![image](https://user-images.githubusercontent.com/109258397/222918372-ffeabf2f-1a09-4ded-87a2-169554ca5e51.png)
  - 주로 동적인 화면에 사용, 웹 환경을 마치 앱처럼 필요한 부분부분 변경가능
  - ex_ 구글지도, Gmail, 구글 캘린더
  - 관련기술 : React, Vue.js -> 웹 프론트엔드 개발자